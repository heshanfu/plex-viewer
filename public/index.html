<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json">
    <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico">
    <title>Plex Viewer</title>
  </head>
  <body>
    <noscript>
      You need to enable JavaScript to run this app.
    </noscript>
    <div id="root"></div>
  </body>
  <script>
    const {ipcRenderer} = window.require('electron');
    const Store = window.require('electron-store');
    const webview = document.getElementById('web-view');
    const store = new Store();

    function hideMenu() {
      webview.insertCSS('div[class^="SidebarContainer-sidebarContainer"]{ display: none !important;}');
    }

    function showMenu() {
      webview.insertCSS('div[class^="SidebarContainer-sidebarContainer"]{ display: flex !important;}');
    }

    function toggleSimplePlayerModeOn() {
      webview.insertCSS('div[class^="AudioVideoPlayerControls-buttonGroupLeft"]{ display: none !important;}');
      webview.insertCSS('div[class^="AudioVideoPlayerControls-buttonGroupRight"]{ display: none !important;}');
    }

    function toggleSimplePlayerModeOff() {
      webview.insertCSS('div[class^="AudioVideoPlayerControls-buttonGroupLeft"]{ display: flex !important;}');
      webview.insertCSS('div[class^="AudioVideoPlayerControls-buttonGroupRight"]{ display: flex !important;}');
    }

    webview.addEventListener('dom-ready', function () {
      if (store.get('plexWebLeftPanelHidden')) {
        hideMenu();
      }
      if (store.get('simplePlayerMode')) {
        toggleSimplePlayerModeOn();
      }
    });

    ipcRenderer.on('toggle-left-menu', () => {
      const menuHidden = !store.get('plexWebLeftPanelHidden');
      store.set('plexWebLeftPanelHidden', menuHidden);

      menuHidden ? hideMenu() : showMenu();
    });

    ipcRenderer.on('simple-player-mode', () => {
      const simplePlayerModeEnabled = !store.get('simplePlayerMode');
      store.set('simplePlayerMode', simplePlayerModeEnabled);

      simplePlayerModeEnabled ? toggleSimplePlayerModeOn() : toggleSimplePlayerModeOff();
    });

    ipcRenderer.on('back', () => {
      webview.goBack();
    });

    ipcRenderer.on('forward', () => {
      webview.goForward();
    });

    ipcRenderer.on('play-pause', () => {
      webview.sendInputEvent({type: 'keyDown', keyCode: 'Space'});
    });

    ipcRenderer.on('next', () => {
      webview.sendInputEvent({type: 'keyDown', keyCode: 'Right'});
    });

    ipcRenderer.on('previous', () => {
      webview.sendInputEvent({type: 'keyDown', keyCode: 'Left'});
    });
  </script>
</html>
